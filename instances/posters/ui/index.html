<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Poster Memento - Browser</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Poster Memento</h1>
      <p class="subtitle">Browse and search your poster collection</p>
      <div class="search-bar">
        <input type="text" id="search-input" placeholder="Search posters by title, artist, venue...">
        <select id="search-strategy">
          <option value="hybrid">Hybrid Search</option>
          <option value="graph">Graph Search</option>
          <option value="vector">Semantic Search</option>
        </select>
        <button id="search-btn">Search</button>
        <button id="clear-btn" class="secondary">Clear</button>
      </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="tabs">
      <button class="tab-btn active" data-tab="browse">Browse Collection</button>
      <button class="tab-btn" data-tab="processing">Process Images</button>
    </nav>

    <main>
      <!-- Browse Tab (existing content) -->
      <div id="browse-tab" class="tab-content">
      <div class="controls">
        <div class="left-controls">
          <select id="limit-select">
            <option value="10">10 per page</option>
            <option value="25">25 per page</option>
            <option value="50">50 per page</option>
          </select>
          <span class="total-info">Total: <span id="total-count">0</span> posters</span>
        </div>
        <div class="pagination">
          <button id="prev-btn" disabled>Previous</button>
          <span id="page-info">Page 1</span>
          <button id="next-btn">Next</button>
        </div>
      </div>

      <div id="loading" class="loading hidden">
        <div class="spinner"></div>
        <p>Loading posters...</p>
      </div>

      <div id="error" class="error hidden">
        <p id="error-message"></p>
        <button id="retry-btn">Retry</button>
      </div>

      <div class="table-container">
        <table id="poster-table" class="poster-table">
          <thead>
            <tr>
              <th class="th-thumbnail">Image</th>
              <th class="th-name sortable" data-sort="name">Name <span class="sort-icon"></span></th>
              <th class="th-type sortable" data-sort="poster_type">Type <span class="sort-icon"></span></th>
              <th class="th-artists">People</th>
              <th class="th-venue sortable" data-sort="venue_name">Venue <span class="sort-icon"></span></th>
              <th class="th-date sortable" data-sort="event_date">Date <span class="sort-icon"></span></th>
              <th class="th-added sortable active desc" data-sort="createdAt">Added <span class="sort-icon"></span></th>
            </tr>
          </thead>
          <tbody id="poster-tbody">
            <!-- Poster rows rendered here -->
          </tbody>
        </table>
      </div>

      <!-- Empty State (shown when no posters) -->
      <div id="empty-state" class="empty-state hidden">
        <h3>No posters found</h3>
        <p>Try a different search term or add some posters to get started.</p>
      </div>

      <!-- Detail Modal -->
      <div id="poster-modal" class="modal hidden">
        <div class="modal-content">
          <button class="modal-close" id="modal-close">&times;</button>
          <div id="poster-detail">
            <!-- Single poster detail view -->
          </div>
        </div>
      </div>

      <!-- Image Lightbox Modal -->
      <div id="lightbox-modal" class="lightbox hidden">
        <div class="lightbox-backdrop"></div>
        <div class="lightbox-content">
          <button class="lightbox-close" id="lightbox-close">&times;</button>
          <img id="lightbox-image" src="" alt="">
          <div id="lightbox-caption" class="lightbox-caption"></div>
        </div>
      </div>
      </div><!-- End Browse Tab -->

      <!-- Processing Tab -->
      <div id="processing-tab" class="tab-content hidden">
        <!-- Source Folder Section -->
        <section class="processing-section source-section">
          <h2><span class="icon">üìÅ</span> Source Images</h2>
          <div class="source-controls">
            <input type="text" id="source-path" value="./SourceImages" placeholder="Path to source images" readonly>
            <button type="button" id="scan-btn" class="preview-btn">Scan Folder</button>
            <button type="button" id="refresh-btn" class="secondary-btn">Refresh</button>
          </div>
          <div class="source-stats">
            <span>Total: <strong id="total-images">0</strong> images</span>
            <span>Unprocessed: <strong id="unprocessed-count">--</strong></span>
          </div>
        </section>

        <!-- Configuration Section -->
        <section class="processing-section config-section">
          <h2><span class="icon">‚öôÔ∏è</span> Processing Configuration</h2>
          <div class="config-grid">
            <label>
              Vision Model
              <select id="model-select">
                <option value="">Loading models...</option>
              </select>
            </label>
            <label>
              Batch Size
              <select id="batch-size-select">
                <option value="1">1 (Test single)</option>
                <option value="5" selected>5</option>
                <option value="10">10</option>
                <option value="25">25</option>
              </select>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="skip-existing" checked>
              Skip already processed
            </label>
            <label class="checkbox-label">
              <input type="checkbox" id="store-images" checked>
              Store images in MinIO
            </label>
          </div>
        </section>

        <!-- File Browser Section -->
        <section class="processing-section file-browser-section">
          <h2><span class="icon">üñºÔ∏è</span> Images to Process</h2>
          <div class="file-controls">
            <button type="button" id="select-all-btn">Select All</button>
            <button type="button" id="deselect-all-btn">Deselect All</button>
            <span class="selection-info">Selected: <strong id="selected-count">0</strong></span>
          </div>
          <div class="file-list" id="file-list">
            <div class="file-list-empty">
              <p>No images loaded</p>
              <p>Click "Scan Folder" to discover images</p>
            </div>
          </div>
          <div class="file-pagination">
            <button type="button" id="files-prev-btn" disabled>Previous</button>
            <span id="files-page-info">Page 0 of 0</span>
            <button type="button" id="files-next-btn" disabled>Next</button>
          </div>
        </section>

        <!-- Actions Section -->
        <section class="processing-section actions-section">
          <button type="button" id="preview-btn" class="preview-btn" disabled>Preview Selected</button>
          <button type="button" id="process-btn" class="process-btn" disabled>Process Selected</button>
          <button type="button" id="process-all-btn" class="secondary-btn" disabled>Process All Unprocessed</button>
        </section>

        <!-- Progress Section (shown during processing) -->
        <section id="progress-section" class="processing-section progress-section hidden">
          <h2><span class="icon">‚è≥</span> Processing Progress</h2>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
          <div class="progress-stats">
            <span>Progress: <strong id="progress-percent">0%</strong></span>
            <span>Processed: <strong id="progress-processed">0</strong></span>
            <span class="succeeded">Succeeded: <strong id="progress-succeeded">0</strong></span>
            <span class="failed">Failed: <strong id="progress-failed">0</strong></span>
          </div>
          <div class="progress-log" id="progress-log">
            <!-- Processing log entries will appear here -->
          </div>
          <div class="progress-actions">
            <button type="button" id="cancel-processing-btn" class="secondary-btn">Cancel</button>
          </div>
        </section>
      </div><!-- End Processing Tab -->

      <!-- Preview Modal -->
      <div id="preview-modal" class="modal hidden">
        <div class="modal-content preview-modal-content">
          <button type="button" class="modal-close" id="preview-modal-close">&times;</button>
          <div class="preview-layout">
            <div class="preview-image-container">
              <img id="preview-image" src="" alt="Preview">
            </div>
            <div class="preview-results">
              <h3>Extraction Results</h3>
              <div id="preview-loading" class="preview-loading hidden">
                <div class="spinner"></div>
                <p>Processing image with vision model...</p>
              </div>
              <div id="preview-data" class="preview-data hidden">
                <!-- Extracted data fields will be rendered here -->
              </div>
              <div id="preview-error" class="preview-error hidden">
                <div class="error-icon">‚ö†Ô∏è</div>
                <p id="preview-error-message">Error message</p>
              </div>
            </div>
          </div>
          <div class="preview-actions">
            <span class="preview-info">Processing time: <strong id="preview-time">--</strong>ms | Model: <strong id="preview-model">--</strong></span>
            <div class="preview-buttons">
              <button type="button" id="preview-commit-btn" class="process-btn" disabled>Commit to Database</button>
              <button type="button" id="preview-close-btn" class="secondary-btn">Close</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <p>Poster Memento - Knowledge Graph Powered Poster Management</p>
    </footer>
  </div>

  <script type="module" src="js/app.js"></script>
  <script type="module" src="js/processing.js"></script>
</body>
</html>
